<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="stylesheet" href="discovery.css">
</head>

<body>
    <div id="test">시계 위젯, 달력 위젯 책꽂이</div>

    <div id="monitor">
        <div id="game_container">
            <div id="list_cover">
                <div id="game_list">
                    <div class="li">● 순서 맞추기</div>
                    <div class="li">● 카드 뒤집기</div>
                    <div class="li">● ??? ???</div>
                </div>
            </div>
            <div id="game">
                <div id="game_exit"></div>
            </div>
            <div id="game_name">
                <div id="game_info"></div>
            </div>
            <div id="game_screen">
                <div id="game_content"></div>
                <div id="notice_cover">
                    <div id="notice_info"></div>
                    <div id="reset"></div>
                </div>
                <div id="ready_cover" class="ready_small"></div>
                <div id="game_screen_cover"></div>
            </div>

            <div id="start_cover">
                <div id="initiate_button">Start...</div>
            </div>

        </div>
    </div>
    <div id="mouse">
        <div id="mouse_background">
            <div id="left_hover_background"></div>
            <div id="right_hover_background"></div>
            <div id="mouse_background_image"></div>
        </div>
        <div id="left_button" class="mouse_button"></div>
        <div id="right_button" class="mouse_button"></div>

    </div>
    <div id="background">
        <div id="postit1">
            <div class="postit_cover"></div>
            <div class="postit_container">
                <div>단계</div>
                <div id="board_stage"></div>
            </div>
        </div>
        <div id="postit2">
            <div class="postit_cover"></div>
            <div class="postit_container">
                <div>기회</div>
                <div id="board_chance"></div>
            </div>
        </div>

        <div id="background_upper"></div>
        <div id="background_below">
            <div id="desktop"></div>
        </div>
    </div>
    <script>
        // 모니터 켜는 부분
        const initButton = document.getElementById('initiate_button'); // 인트로 시작 버튼
        const startCover = document.getElementById('start_cover'); // 인트로 커버
        const postitCovers = document.querySelectorAll('.postit_cover'); // 포스트잇(정보)
        const gameInfo = document.getElementById('game_info'); // 게임 제목
        const leftButton = document.getElementById('left_button'); // 마우스 이미지 왼쪽버튼
        const rightButton = document.getElementById('right_button'); //마우스 이미지 오른쪽버튼
        const mouse = document.getElementById('mouse'); //마우스 이미지
        const gameScreen = document.getElementById('game_screen');
        const gameContent = document.getElementById('game_content');

        const gameExit = document.getElementById('game_exit'); //게임창 나가기 버튼
        const gameList = document.querySelectorAll('.li'); // 게임 리스트
        const gameWindow = document.getElementById('game'); // 게임 창

        initMouseEvent(); // 마우스 호버 이벤트 추가

        let gameInfoDegree = 0;
        let currentGame = null;
        let initCount = 2;
        let initInterval = setInterval(() => {
            initButton.textContent = `Start${'.'.repeat(1+initCount%3)}`
            initCount++;
        }, 1000)


        let games = {
            order: {
                name: '순서 맞추기',
                stage: 1,
                boxNum: [4, 4, 4, 4, 9, 9, 9, 9, 16, 16],
                chance: [1, 1, 1, 1, 2, 2, 2, 3, 3, 3],
                difficult: [4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
                initGame: function (chance = this.chance[this.stage - 1]) {
                    document.getElementById('board_stage').textContent = this.stage;
                    document.getElementById('board_chance').textContent = chance;
                },

                checkInput: function (input, answer) {
                    const inputString = input.map(el => el.toString()).join('');
                    const answerString = answer.slice(0, input.length).map(el => el.toString()).join('');

                    return inputString === answerString;
                },
                createRandomArray: function () {
                    const len = this.difficult[this.stage - 1];
                    const arr = [];
                    for (let i = 0; i < len; i++) {
                        arr.push(Math.floor(Math.random() * this.boxNum[this.stage - 1]));
                    }
                    return arr;
                }
            },
            card: {
                name: "같은 그림 찾기",
                stage: 1,
                chance: [1, 2, 2, 3, 4, 4, 5, 5],
                stageList: [0, 4, 6, 8, 12, 16, 18, 20],
                initGame: function (chance = this.chance[this.stage - 1]) {
                    document.getElementById('board_stage').textContent = this.stage;
                    document.getElementById('board_chance').textContent = chance;
                },
            },

        }
         function createOrderGame () {
                    readyForGame();
                    const gameContainer = document.getElementById('game_content');
                    gameContainer.innerHTML = '';
                    const screenCover = document.getElementById('game_screen_cover');
                    const boxNum = Math.sqrt(games.order.boxNum[games.order.stage - 1]);
                    const difficult = games.order.difficult[games.order.stage - 1];
                    let chance = games.order.chance[games.order.stage - 1];
                    const answer = games.order.createRandomArray(games.order.stage);
                    const input = [];
                    const noticeCover= document.getElementById('notice_cover');
                    const reset = document.getElementById('reset');

                    console.log(answer);
                    for (let i = 0; i < boxNum; i++) {
                        const row = document.createElement('div');
                        row.classList.add('order_row');
                        row.style.height = `${90/boxNum}%`;
                        for (let j = 0; j < boxNum; j++) {
                            const box = document.createElement('div');
                            box.classList.add('order_box');
                            box.style.width = `${90/boxNum}%`;
                            box.addEventListener('click', (e) => {
                                input.push(i * boxNum + j);
                                console.log(input);
                                if (games.order.checkInput(input, answer)) {
                                    e.target.style.background = 'skyblue';
                                    if (input.length === answer.length) {
                                        gameInfo.style.opacity=0;
                                        noticeCover.style.display='flex';
                                        noticeCover.children[0].textContent='Success!';
                                        noticeCover.children[1].textContent='다음 단계';
                                        noticeCover.style.color='#fffbc5';
                                        noticeCover.children[1].style.border='5px solid #fffbc5';
                                        gameContainer.innerHTML = '';
                                        games.order.stage += 1;
                                        setTimeout(()=>{
                                            noticeCover.style.opacity=1;
                                        },500)
                                        games.order.initGame(chance);
                                    }
                                } else {
                                    chance--;
                                    games.order.initGame(chance);
                                    if (chance > 0) {
                                        e.target.classList.add('order_wrong');
                                        setTimeout(() => {
                                            e.target.classList.remove('order_wrong');
                                        }, 1000)
                                    } else {
                                        gameInfo.style.opacity=0;
                                        noticeCover.style.display='flex';
                                        noticeCover.style.color='#c1c5c1';
                                        noticeCover.children[1].style.border='5px solid #c1c5c1';
                                        noticeCover.children[0].textContent='Failed...'
                                        noticeCover.children[1].textContent='다시 하기'
                                        gameContainer.innerHTML = '';
                                        setTimeout(()=>{
                                            noticeCover.style.opacity=1;
                                            
                                        },500)
                                        games.order.stage=1;                       
                                    }

                                }
                            })
                            row.appendChild(box);
                        }
                        gameContainer.appendChild(row);
                    }
                    const boxes = document.querySelectorAll('.order_box');
                    screenCover.style.display = 'block';
                    answer.forEach((el, idx) => {
                        setTimeout(() => {
                            boxes[el].style.background = 'pink';
                            setTimeout(() => {
                                boxes[el].style.background = 'ivory';
                            }, 700)
                        }, 4000 + 1000 * idx)
                    })
                    setTimeout(() => {
                        screenCover.style.display = 'none';
                    }, 4000 + boxes.length * 1000);

                    reset.addEventListener('click',()=>{
                        gameInfo.style.opacity=1;
                        games.order.initGame();
                        noticeCover.style.opacity=0;
                        setTimeout(()=>{
                            noticeCover.style.display='none';
                        createOrderGame(games.order.stage);
                            
                        },1000)
                    })
                }

        gameExit.addEventListener('click', () => {
            gameInfoDegree -= 360;
            gameInfo.style.transform = `rotateX(${gameInfoDegree}deg)`;
            postitCovers.forEach(el => {
                el.classList.remove('postit_cover_off');
            })
            games[currentGame].stage=1;
            currentGame = null;
            mouse.style.opacity = 0;
            gameContent.style.opacity = 0;
            document.getElementById('ready_cover').style.display='none';
            setTimeout(() => {
                gameContent.style.display = 'none';
                gameScreen.style.display = 'none';
            }, 1000)
            setTimeout(() => {
                gameInfo.textContent = '';
                setTimeout(() => {
                    gameWindow.classList.remove('game_on');
                }, 500)
            }, 200)
        })

        // 게임 리스트에서 게임 선택

        gameList.forEach(el => {
            el.addEventListener('click', (e) => {
                gameWindow.classList.add('game_on');
                postitCovers.forEach(el => {
                    el.classList.add('postit_cover_off');
                })
                currentGame = games.order;
                gameInfoDegree += 360;
                setTimeout(() => {
                    gameInfo.style.transform = `rotateX(-${gameInfoDegree}deg)`;
                    setTimeout(() => {
                        gameInfo.textContent = el.textContent.slice(2);
                    }, 500)
                }, 1000)
                const chosen = e.target.textContent.slice(2);
                gameScreen.style.display = 'block';
                gameContent.style.display = 'flex';

                if (chosen === '순서 맞추기') {
                    games.order.initGame();
                    currentGame='order';
                    setTimeout(() => {
                        gameContent.style.opacity = 1;
                        createOrderGame();
                    }, 1000)
                }
                if (chosen == '카드 뒤집기'){
                    games.card.initGame();
                    setTimeout(()=>{
                        setTimeout(() => {
                        gameContent.style.opacity = 1;
                        games.card.createGame();
                    }, 1000)
                    })
                }
                mouse.style.opacity = 1;
            })

        })

        // 맨 처음 인트로 페이지 시작 버튼 누르면
        // 게임 리스트가 나옴

        initButton.addEventListener('click', () => {
            clearInterval(initInterval);
            startCover.classList.add('init_event');
            setTimeout(() => {
                startCover.style.display = 'none';
            }, 1000)
        })

        function readyForGame() {
            const readyCover = document.getElementById('ready_cover');
            readyCover.textContent = '3';
            readyCover.style.display = 'flex';
            readyCover.style.opacity = 1;
            setTimeout(() => {
                readyCover.classList.remove('ready_small');
                setTimeout(() => {
                    readyCover.classList.add('ready_small');
                    setTimeout(() => {
                        readyCover.textContent = '2';
                        readyCover.classList.remove('ready_small');
                        setTimeout(() => {
                            readyCover.classList.add('ready_small');
                            setTimeout(() => {
                                readyCover.classList.remove('ready_small');
                                readyCover.textContent = '1';
                                setTimeout(() => {
                                    readyCover.classList.add(
                                        'ready_small');
                                    readyCover.opacity = 0;
                                    setTimeout(() => {
                                        readyCover.style
                                            .display = 'none';
                                    }, 500)
                                }, 500)
                            }, 500)
                        }, 500)
                    }, 500)
                }, 500)
            }, 500)

        }

        function initMouseEvent() { // 마우스아이콘에 이벤트 등록 함수
            leftButton.onmouseenter = () => {
                document.getElementById('left_hover_background').style.background = '#0b6676';
            }
            rightButton.onmouseenter = () => {
                document.getElementById('right_hover_background').style.background = '#0b6676';
            }
            leftButton.onmouseleave = () => {
                document.getElementById('left_hover_background').style.background = 'transparent';
            }
            rightButton.onmouseleave = () => {
                document.getElementById('right_hover_background').style.background = 'transparent';
            }
        }
    </script>
</body>

</html>